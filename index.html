<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OlmoEarth - Urban Analysis Platform</title>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTUiIGZpbGw9IiMyNTYzZWIiLz48cGF0aCBmaWxsPSIjZmZmIiBkPSJtMTYgNyAyIDcgNyAyLTcgMi0yIDctMi03LTctMiA3LTJaIi8+PC9zdmc+">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .narrative {
            max-inline-size: 44rem;
        }

        .app-content {
            font-size: 1.05rem;
        }

        .app-content .small,
        .app-content small {
            font-size: 0.95rem;
        }

        .app-content .lead {
            font-size: 1.35rem;
        }

        .city-card {
            transition: all 0.2s ease;
            border: 1px solid var(--bs-border-color);
            cursor: pointer;
        }

        .city-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border-color: var(--bs-primary);
        }

        .city-card:active {
            transform: translateY(0);
        }

        .city-card.active {
            border-color: var(--bs-primary) !important;
            background-color: rgba(13, 110, 253, 0.05);
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }

        .card-img-placeholder {
            height: 140px;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #94a3b8;
            font-size: 3rem;
        }

        /* Viewer Section - Full Screen Overlay */
        #viewer-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 2000;
            background: #0f172a;
            display: flex;
            flex-direction: column;
        }

        #viewer-header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
            padding: 0.75rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 2001;
        }

        #viewer-section {
            flex: 1;
            position: relative;
            width: 100%;
            overflow: hidden;
        }

        #viewer-frame {
            width: 100%;
            height: 100%;
            border: none;
            background: #0f172a;
            display: block;
        }

        /* Technical Deep Dive Styles */
        .tech-card {
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease;
        }

        .tech-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
        }

        .tech-icon-bg {
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 8rem;
            color: rgba(255, 255, 255, 0.03);
            transform: rotate(15deg);
            pointer-events: none;
            transition: transform 0.5s ease;
        }

        .tech-card:hover .tech-icon-bg {
            transform: rotate(0deg) scale(1.1);
        }

        .pipeline-step {
            transition: all 0.3s ease;
            margin-bottom: 0;
            z-index: 2;
        }

        .pipeline-step:hover {
            background-color: var(--bs-body-bg) !important;
            border-color: var(--bs-success) !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transform: translateX(5px);
        }

        .deep-dive-content,
        .replicate-content {
            font-size: 1.05rem;
        }

        .deep-dive-content .small,
        .replicate-content .small,
        .deep-dive-content small,
        .replicate-content small {
            font-size: 0.95rem;
        }

        .pipeline-line {
            position: absolute;
            left: 31px;
            top: 45px;
            width: 2px;
            height: 30px;
            background: var(--bs-border-color);
            z-index: 1;
        }

        .feature-icon {
            transition: transform 0.3s ease;
        }

        .feature-item:hover .feature-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .fade-in-up {
            animation: fadeInUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }


        #loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0f172a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary border-bottom" data-bs-theme="dark">
        <div class="container-fluid"><a class="navbar-brand d-flex align-items-center gap-2" href="#"><i
                    class="bi bi-globe-americas text-primary"></i>OlmoEarth </a><button class="navbar-toggler"
                type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span
                    class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">

                <div class="nav-item dropdown ms-auto" role="group" aria-label="Toggle dark mode"
                    title="Toggle Dark Mode"><button class="dark-theme-toggle btn btn-outline-light dropdown-toggle"
                        type="button" data-bs-toggle="dropdown" aria-expanded="false"
                        aria-label="Toggle theme (light)"><i class="bi bi-circle-half"></i><span
                            class="d-lg-none ms-2">Toggle theme</span></button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><button class="dropdown-item" data-bs-theme-value="light" aria-pressed="false"><i
                                    class="me-2 bi bi-sun-fill"></i>Light</button></li>
                        <li><button class="dropdown-item active" data-bs-theme-value="dark" aria-pressed="true"><i
                                    class="me-2 bi bi-moon-stars-fill"></i>Dark</button></li>
                        <li><button class="dropdown-item" data-bs-theme-value="auto" aria-pressed="false"><i
                                    class="me-2 bi bi-circle-half"></i>Auto</button></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
    <div class="container mt-5">
        <div class="text-center mb-5">
            <h1 class="display-3 fw-bold mb-3">Urban Analysis Platform</h1>
            <h2 class="display-6 text-muted mb-4">Analyze urban growth,
                vegetation,
                and density changes over time.</h2>
            <div class="mx-auto narrative text-secondary fs-5">
                <p>OlmoEarth leverages satellite imagery and machine learning to track urban evolution. Explore detailed
                    metrics for cities worldwide,
                    comparing data from 2019 to 2024. </p>
            </div>
        </div>
        <div class="app-content">
        <div id="cities-grid" class="mb-5">
            <h3 class="h4 mb-4 border-bottom pb-2">Available Cities</h3>
            <div class="row g-4">
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 city-card" onclick="loadCity('bangalore', this)">
                        <div class="card-img-placeholder"><i class="bi bi-buildings"></i></div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title mb-0">Bangalore</h5><span
                                    class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-10">India</span>
                            </div>
                            <p class="card-text small text-muted">IT Hub of India. Analysis of rapid
                                urbanization and green cover loss.</p>
                            <div class="d-flex align-items-center gap-2 mt-3"><span class="badge bg-primary">Analysis
                                    Ready</span></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 city-card" onclick="loadCity('chennai', this)">
                        <div class="card-img-placeholder"><i class="bi bi-water"></i></div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title mb-0">Chennai</h5><span
                                    class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-10">India</span>
                            </div>
                            <p class="card-text small text-muted">Coastal metropolis. Tracking urban density
                                and vegetation changes.</p>
                            <div class="d-flex align-items-center gap-2 mt-3"><span class="badge bg-primary">Analysis
                                    Ready</span></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 city-card" onclick="loadCity('delhi', this)">
                        <div class="card-img-placeholder"><i class="bi bi-geo-alt"></i></div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title mb-0">Delhi</h5><span
                                    class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-10">India</span>
                            </div>
                            <p class="card-text small text-muted">National Capital Territory.
                                Analysis of urban expansion and green cover.</p>
                            <div class="d-flex align-items-center gap-2 mt-3"><span class="badge bg-primary">Analysis
                                    Ready</span></div>
                        </div>
                    </div>
                </div>

                <!-- International Cities -->
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 city-card" onclick="loadCity('paris', this)">
                        <div class="card-img-placeholder"><i class="bi bi-torii-gate"></i></div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title mb-0">Paris</h5><span
                                    class="badge bg-info bg-opacity-10 text-info border border-info border-opacity-10">France</span>
                            </div>
                            <p class="card-text small text-muted">The City of Light. Analyzing green spaces and urban
                                density in the 20 arrondissements.</p>
                            <div class="d-flex align-items-center gap-2 mt-3"><span class="badge bg-primary">Analysis
                                    Ready</span></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 city-card" onclick="loadCity('london', this)">
                        <div class="card-img-placeholder"><i class="bi bi-clock"></i></div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title mb-0">London</h5><span
                                    class="badge bg-info bg-opacity-10 text-info border border-info border-opacity-10">UK</span>
                            </div>
                            <p class="card-text small text-muted">Historic Metropolis. Detailed ward-level analysis of
                                urban fabric and vegetation.</p>
                            <div class="d-flex align-items-center gap-2 mt-3"><span class="badge bg-primary">Analysis
                                    Ready</span></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 city-card" onclick="loadCity('singapore', this)">
                        <div class="card-img-placeholder"><i class="bi bi-building-fill"></i></div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title mb-0">Singapore</h5><span
                                    class="badge bg-warning bg-opacity-10 text-warning border border-warning border-opacity-10">Asia</span>
                            </div>
                            <p class="card-text small text-muted">The Garden City. High-resolution analysis of urban
                                density and tropical vegetation.</p>
                            <div class="d-flex align-items-center gap-2 mt-3"><span class="badge bg-primary">Analysis
                                    Ready</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="mb-5 fade-in-up deep-dive-content" style="animation-delay: 0.2s;">
            <h3 class="h4 mb-4 border-bottom pb-2">Technical Deep Dive</h3>
            <div class="row g-4">
                <div class="col-lg-6">
                    <div class="card h-100 border-0 bg-dark-subtle tech-card overflow-hidden">
                        <div class="card-body position-relative z-1">
                            <div class="tech-icon-bg"><i class="bi bi-cpu"></i></div>
                            <h5 class="card-title d-flex align-items-center gap-2">
                                <i class="bi bi-cpu text-primary"></i>OlmoEarth Foundation Model
                            </h5>
                            <p class="card-text mt-3 text-secondary">
                                At the core of this platform lies the <a
                                    href="https://github.com/allenai/olmoearth_pretrain"
                                    class="text-decoration-none fw-bold text-primary">OlmoEarth Foundation Model</a>, a
                                state-of-the-art vision transformer trained on petabytes of satellite imagery by the <a
                                    href="https://allenai.org/" class="text-decoration-none">Allen Institute for AI</a>.
                            </p>
                            <p class="card-text text-secondary">
                                Unlike traditional remote sensing that relies on simple algebraic band combinations
                                (like NDVI for vegetation), OlmoEarth "sees" the world semantically, understanding
                                texture, context, and complex spatial relationships.
                            </p>
                            <div class="mt-4">
                                <div class="feature-item p-2 rounded mb-2 d-flex align-items-center gap-3">
                                    <div class="feature-icon bg-primary bg-opacity-10 text-primary rounded p-2">
                                        <i class="bi bi-layers-fill"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold small">Vision Transformer (ViT) Architecture</div>
                                        <div class="small text-muted">Learns rich spatial features from multi-band
                                            imagery. <a href="https://arxiv.org/abs/2010.11929"
                                                class="text-muted text-decoration-underline">Read Paper</a></div>
                                    </div>
                                </div>
                                <div class="feature-item p-2 rounded mb-2 d-flex align-items-center gap-3">
                                    <div class="feature-icon bg-primary bg-opacity-10 text-primary rounded p-2">
                                        <i class="bi bi-grid-3x3-gap-fill"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold small">768-Dimension Embeddings</div>
                                        <div class="small text-muted">High-fidelity vectors that encode semantic
                                            information for every 10 m x 10 m patch of earth.</div>
                                    </div>
                                </div>
                                <div class="feature-item p-2 rounded d-flex align-items-center gap-3">
                                    <div class="feature-icon bg-primary bg-opacity-10 text-primary rounded p-2">
                                        <i class="bi bi-intersect"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold small">Multi-Modal Fusion</div>
                                        <div class="small text-muted">Combines Sentinel-2 (Optical) and Sentinel-1
                                            (Radar) data for all-weather monitoring.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card h-100 border-0 bg-dark-subtle tech-card overflow-hidden">
                        <div class="card-body position-relative z-1">
                            <div class="tech-icon-bg"><i class="bi bi-hdd-network"></i></div>
                            <h5 class="card-title d-flex align-items-center gap-2">
                                <i class="bi bi-hdd-network text-success"></i>Our Analysis Pipeline
                            </h5>
                            <p class="card-text mt-3 text-secondary">
                                We built an end-to-end automated pipeline to transform raw satellite data into
                                actionable insights.
                            </p>
                            <div class="pipeline-container mt-4 d-flex flex-column gap-3">
                                <div
                                    class="pipeline-step p-3 rounded bg-body-tertiary border border-dark-subtle position-relative">
                                    <div class="d-flex gap-3 align-items-center">
                                        <div class="step-indicator bg-success text-white rounded-circle d-flex align-items-center justify-content-center"
                                            style="width: 32px; height: 32px;">1</div>
                                        <div>
                                            <div class="fw-bold">Ingestion via STAC API</div>
                                            <div class="small text-muted">Automated querying and validation of
                                                low-cloud imagery from <a
                                                    href="https://planetarycomputer.microsoft.com/"
                                                    class="text-muted text-decoration-underline">Microsoft Planetary
                                                    Computer</a>.</div>
                                        </div>
                                    </div>
                                </div>
                                <div
                                    class="pipeline-step p-3 rounded bg-body-tertiary border border-dark-subtle position-relative">
                                    <div class="d-flex gap-3 align-items-center">
                                        <div class="step-indicator bg-success text-white rounded-circle d-flex align-items-center justify-content-center"
                                            style="width: 32px; height: 32px;">2</div>
                                        <div>
                                            <div class="fw-bold">Model Inference</div>
                                            <div class="small text-muted">Runs the OlmoEarth foundation model on GPU
                                                when available to generate dense embeddings.</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="pipeline-step p-3 rounded bg-body-tertiary border border-dark-subtle">
                                    <div class="d-flex gap-3 align-items-center">
                                        <div class="step-indicator bg-success text-white rounded-circle d-flex align-items-center justify-content-center"
                                            style="width: 32px; height: 32px;">3</div>
                                        <div>
                                            <div class="fw-bold">Geospatial Analysis</div>
                                            <div class="small text-muted">Spatial aggregation of embeddings within
                                                administrative boundaries (wards) to compute change metrics.</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- How to Replicate Section -->
        <div class="mb-5 fade-in-up" style="animation-delay: 0.4s;">
            <h3 class="h4 mb-4 border-bottom pb-2">How to Replicate this Analysis</h3>
            <div class="card border-0 bg-dark-subtle">
                <div class="card-body p-4 replicate-content">
                    <p class="lead text-secondary mb-4">You can run this exact analysis for your own city using our
                        open-source toolkit. Follow the minimal, correct workflow below: prepare data windows, run GPU
                        embeddings, analyze wards, and generate the map.</p>

                    <div class="accordion" id="replicationAccordion">
                        <!-- Step 0: Minimal File Structure -->
                        <div class="accordion-item bg-body-tertiary border border-secondary mb-3 rounded overflow-hidden">
                            <h2 class="accordion-header">
                                <button class="accordion-button bg-body-tertiary text-body shadow-none collapsed py-3"
                                    type="button" data-bs-toggle="collapse" data-bs-target="#collapseZero">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="bg-info bg-opacity-25 p-2 rounded text-info">
                                            <i class="bi bi-folder2-open fs-5"></i>
                                        </div>
                                        <div>
                                            <div class="fw-bold fs-5">0. Minimal File Structure</div>
                                            <div class="small text-body-secondary">Know where files go before you run
                                                scripts</div>
                                        </div>
                                    </div>
                                </button>
                            </h2>
                            <div id="collapseZero" class="accordion-collapse collapse"
                                data-bs-parent="#replicationAccordion">
                                <div class="accordion-body text-secondary pt-0">
                                    <hr class="border-secondary mb-4">
                                    <div class="bg-dark p-3 rounded border border-secondary shadow-sm">
                                        <code class="text-info font-monospace small"
                                            style="white-space: pre;">olmoearth/
├── cities_config.json
├── config.json
├── prepare_city.sh
├── run_prediction.py
├── analyze_city.py
├── generate_visualization.py
├── process_all_cities.py
├── check_status.sh
├── windows/
│   └── &lt;city_key&gt;/
│       └── windows/
│           ├── 2019/
│           └── 2024/
├── public_html/
│   └── &lt;city_key&gt;.html
└── &lt;city_key&gt;.geojson
                                        </code>
                                    </div>
                                    <div class="small mt-2">You only need to add your GeoJSON and update
                                        <code>cities_config.json</code>; all other files already exist in this repo.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 1: System Requirements -->
                        <div class="accordion-item bg-body-tertiary border border-secondary mb-3 rounded overflow-hidden">
                            <h2 class="accordion-header">
                                <button class="accordion-button bg-body-tertiary text-body shadow-none collapsed py-3"
                                    type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="bg-primary bg-opacity-25 p-2 rounded text-primary">
                                            <i class="bi bi-tools fs-5"></i>
                                        </div>
                                        <div>
                                            <div class="fw-bold fs-5">1. System Requirements & Setup</div>
                                            <div class="small text-body-secondary">Hardware specs and installation</div>
                                        </div>
                                    </div>
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse"
                                data-bs-parent="#replicationAccordion">
                                <div class="accordion-body text-secondary pt-0">
                                    <hr class="border-secondary mb-4">
                                    <div class="row g-4 mb-4">
                                        <div class="col-md-6">
                                            <h6 class="text-body-emphasis fw-bold mb-3"><i
                                                    class="bi bi-cpu me-2"></i>Hardware
                                            </h6>
                                            <ul class="list-unstyled d-flex flex-column gap-2 small">
                                                <li
                                                    class="d-flex justify-content-between border-bottom border-secondary pb-2">
                                                    <span>OS</span>
                                                    <span class="text-body-emphasis">Linux (Ubuntu 20.04+)</span>
                                                </li>
                                                <li
                                                    class="d-flex justify-content-between border-bottom border-secondary pb-2">
                                                    <span>GPU</span>
                                                    <span class="text-body-emphasis">NVIDIA (8GB+ VRAM, optional)</span>
                                                </li>
                                                <li
                                                    class="d-flex justify-content-between border-bottom border-secondary pb-2">
                                                    <span>Python</span>
                                                    <span class="text-body-emphasis">3.10+</span>
                                                </li>
                                                <li
                                                    class="d-flex justify-content-between border-bottom border-secondary pb-2">
                                                    <span>RAM</span>
                                                    <span class="text-body-emphasis">32GB Recommended</span>
                                                </li>
                                                <li
                                                    class="d-flex justify-content-between border-bottom border-secondary pb-2">
                                                    <span>Storage</span>
                                                    <span class="text-body-emphasis">100GB+ SSD</span>
                                                </li>
                                                <li class="d-flex justify-content-between pb-2">
                                                    <span>Network</span>
                                                    <span class="text-body-emphasis">Stable for large downloads</span>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="col-md-6">
                                            <h6 class="text-body-emphasis fw-bold mb-3"><i
                                                    class="bi bi-code-square me-2"></i>Environment</h6>
                                            <div class="bg-dark p-3 rounded border border-secondary shadow-sm">
                                                <code class="text-success small opacity-75">
                                                    # 1. Clone & Setup<br>
                                                    git clone https://github.com/allenai/olmo-earth.git<br>
                                                    cd olmo-earth<br><br>
                                                    # 2. Virtual Environment<br>
                                                    python3 -m venv venv && source venv/bin/activate<br><br>
                                                    # 3. Install rslearn + data sources<br>
                                                    pip install -e rslearn_repo[extra]
                                                </code>
                                            </div>
                                            <div class="small text-muted mt-2">Note: downloads are large; plan disk
                                                space and time accordingly.</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Configuration -->
                        <div class="accordion-item bg-body-tertiary border border-secondary mb-3 rounded overflow-hidden">
                            <h2 class="accordion-header">
                                <button class="accordion-button bg-body-tertiary text-body shadow-none collapsed py-3"
                                    type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="bg-warning bg-opacity-25 p-2 rounded text-warning">
                                            <i class="bi bi-gear-fill fs-5"></i>
                                        </div>
                                        <div>
                                            <div class="fw-bold fs-5">2. City Configuration</div>
                                            <div class="small text-body-secondary">GeoJSON + city mapping file
                                                (required)</div>
                                        </div>
                                    </div>
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse"
                                data-bs-parent="#replicationAccordion">
                                <div class="accordion-body text-secondary pt-0">
                                    <hr class="border-secondary mb-4">

                                    <!-- GeoJSON Section -->
                                    <div class="mb-4">
                                        <h6 class="text-body-emphasis fw-bold d-flex align-items-center gap-2">
                                            <i class="bi bi-geo-alt"></i> 1. Prepare GeoJSON (EPSG:4326)
                                        </h6>
                                        <p class="small text-secondary">
                                            The analysis requires a GeoJSON file with granular units (wards/districts).
                                            <span class="text-warning">Crucially, it must be in the WGS84 coordinate
                                                system (Lat/Lon).</span>
                                            If your government data is in meters (e.g., EPSG:27700 or EPSG:32643), you
                                            <strong>must</strong> reproject it first.
                                        </p>
                                        <div class="bg-dark p-3 rounded border border-secondary shadow-sm">
                                            <div class="small text-muted mb-2">// Example: reproject to WGS84 using
                                                pyproj</div>
                                            <code class="text-info font-monospace small" style="white-space: pre;">
from pyproj import Transformer
from shapely.ops import transform
import json

# Setup transformer: Source CRS -> EPSG:4326
transformer = Transformer.from_crs("EPSG:27700", "EPSG:4326", always_xy=True)

# ... load your json features ...
# Transform each geometry
new_shape = transform(transformer.transform, original_shape)
                                            </code>
                                        </div>
                                    </div>

                                    <div class="row g-4">
                                        <div class="col-lg-6">
                                            <h6 class="text-body-emphasis fw-bold d-flex align-items-center gap-2">
                                                <i class="bi bi-file-earmark-code"></i> 2. Add City to cities_config.json
                                            </h6>
                                            <p class="small">Register your GeoJSON file, field mappings, and the window
                                                folders created by the pipeline. The <code>windows_dirs</code> should
                                                match what <code>prepare_city.sh</code> creates.</p>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="bg-dark p-3 rounded border border-secondary shadow-sm h-100">
                                                <code class="text-info font-monospace small"
                                                    style="white-space: pre;">
"your_city": {
  "name": "Your City",
  "country": "Country",
  "geojson_file": "your_city.geojson",
  "center": [lon, lat],
  "ward_id_field": "WARD_ID",
  "ward_name_field": "WARD_NAME",
  "ward_no_field": "WARD_NO",
  "years": ["2019", "2024"],
  "windows_dirs": {
    "2019": "windows/your_city/windows/2019",
    "2024": "windows/your_city/windows/2024"
  },
  "output_prefix": "your_city"
}
                                                </code>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="small text-muted mt-2">If you are unsure about field names, open your
                                        GeoJSON and inspect the <code>properties</code> object for one feature.</div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Execution -->
                        <div class="accordion-item bg-body-tertiary border border-secondary mb-3 rounded overflow-hidden">
                            <h2 class="accordion-header">
                                <button class="accordion-button bg-body-tertiary text-body shadow-none collapsed py-3"
                                    type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="bg-success bg-opacity-25 p-2 rounded text-success">
                                            <i class="bi bi-play-circle-fill fs-5"></i>
                                        </div>
                                        <div>
                                            <div class="fw-bold fs-5">3. Execution Pipeline</div>
                                            <div class="small text-body-secondary">Download, Embeddings, Analysis,
                                                Visualization</div>
                                        </div>
                                    </div>
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse"
                                data-bs-parent="#replicationAccordion">
                                <div class="accordion-body text-secondary pt-0">
                                    <hr class="border-secondary mb-4">
                                    <p class="small">Run the scripts in order. This can take hours depending on data
                                        size, bandwidth, and GPU availability.</p>

                                    <div class="d-flex flex-column gap-3">
                                        <div class="d-flex gap-3">
                                            <div class="d-flex flex-column align-items-center">
                                                <div class="rounded-circle bg-dark border border-secondary d-flex align-items-center justify-content-center text-light small fw-bold"
                                                    style="width: 24px; height: 24px;">1</div>
                                                <div class="h-100 border-start border-secondary my-1"></div>
                                            </div>
                                            <div class="pb-3 w-100">
                                                <h6 class="text-body-emphasis fw-bold mb-1">Data Preparation</h6>
                                                <code
                                                    class="d-block bg-dark p-2 rounded border border-secondary text-warning mb-2 small w-100">./prepare_city.sh &lt;city_key&gt;</code>
                                                <div class="small">Builds windows, queries imagery, downloads and
                                                    materializes Sentinel data into <code>windows/&lt;city_key&gt;</code>.
                                                </div>
                                            </div>
                                        </div>

                                        <div class="d-flex gap-3">
                                            <div class="d-flex flex-column align-items-center">
                                                <div class="rounded-circle bg-dark border border-secondary d-flex align-items-center justify-content-center text-light small fw-bold"
                                                    style="width: 24px; height: 24px;">2</div>
                                                <div class="h-100 border-start border-secondary my-1"></div>
                                            </div>
                                            <div class="pb-3 w-100">
                                                <h6 class="text-body-emphasis fw-bold mb-1">Inference (GPU)</h6>
                                                <code
                                                    class="d-block bg-dark p-2 rounded border border-secondary text-warning mb-2 small w-100">python3 run_prediction.py &lt;city_key&gt;</code>
                                                <div class="small">Runs OlmoEarth to generate embeddings (GPU is used
                                                    automatically if available).</div>
                                            </div>
                                        </div>

                                        <div class="d-flex gap-3">
                                            <div class="d-flex flex-column align-items-center">
                                                <div class="rounded-circle bg-dark border border-secondary d-flex align-items-center justify-content-center text-light small fw-bold"
                                                    style="width: 24px; height: 24px;">3</div>
                                                <div class="h-100 border-start border-secondary my-1"></div>
                                            </div>
                                            <div class="w-100">
                                                <h6 class="text-body-emphasis fw-bold mb-1">Metric Analysis</h6>
                                                <code
                                                    class="d-block bg-dark p-2 rounded border border-secondary text-warning mb-2 small w-100">python3 analyze_city.py &lt;city_key&gt;</code>
                                                <div class="small">Aggregates embeddings into ward metrics and writes a
                                                    detailed JSON report.</div>
                                            </div>
                                        </div>

                                        <div class="d-flex gap-3">
                                            <div class="d-flex flex-column align-items-center">
                                                <div class="rounded-circle bg-dark border border-secondary d-flex align-items-center justify-content-center text-light small fw-bold"
                                                    style="width: 24px; height: 24px;">4</div>
                                            </div>
                                            <div class="w-100">
                                                <h6 class="text-body-emphasis fw-bold mb-1">Visualization</h6>
                                                <code
                                                    class="d-block bg-dark p-2 rounded border border-secondary text-warning mb-2 small w-100">python3 generate_visualization.py &lt;city_key&gt;</code>
                                                <div class="small">Outputs <code>public_html/&lt;city_key&gt;.html</code>
                                                    for the interactive map.</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-4 small text-muted">
                                        Tip: run everything in one go with <code>python3 process_all_cities.py
                                            &lt;city_key&gt;</code> and check progress with
                                        <code>./check_status.sh</code>.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 4: Quick Troubleshooting -->
                        <div class="accordion-item bg-body-tertiary border border-secondary mb-3 rounded overflow-hidden">
                            <h2 class="accordion-header">
                                <button class="accordion-button bg-body-tertiary text-body shadow-none collapsed py-3"
                                    type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="bg-danger bg-opacity-25 p-2 rounded text-danger">
                                            <i class="bi bi-life-preserver fs-5"></i>
                                        </div>
                                        <div>
                                            <div class="fw-bold fs-5">4. Quick Troubleshooting</div>
                                            <div class="small text-body-secondary">Fix common blockers fast</div>
                                        </div>
                                    </div>
                                </button>
                            </h2>
                            <div id="collapseFour" class="accordion-collapse collapse"
                                data-bs-parent="#replicationAccordion">
                                <div class="accordion-body text-secondary pt-0">
                                    <hr class="border-secondary mb-4">
                                    <ul class="list-unstyled small d-flex flex-column gap-2 mb-0">
                                        <li><span class="text-body-emphasis">GeoJSON not found</span> → verify
                                            <code>geojson_file</code> path in <code>cities_config.json</code>.
                                        </li>
                                        <li><span class="text-body-emphasis">No embeddings detected</span> → confirm
                                            <code>windows/&lt;city_key&gt;/windows/2019</code> and <code>2024</code>
                                            exist and that <code>run_prediction.py</code> completed.</li>
                                        <li><span class="text-body-emphasis">Slow downloads</span> → reduce workers in
                                            <code>prepare_city.sh</code> or run overnight.</li>
                                        <li><span class="text-body-emphasis">CPU-only machine</span> → inference still
                                            works but takes much longer.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <div id="viewer-container" class="d-none">
            <div id="viewer-header">
                <h5 class="m-0 text-light" id="viewer-title">City Analysis</h5>
                <button class="btn btn-sm btn-outline-light d-flex align-items-center gap-2" onclick="closeViewer()"><i
                        class="bi bi-x-lg"></i>Close
                </button>
            </div>
            <div id="viewer-section">
                <div id="loading-overlay" class="d-none">
                    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
                    <div class="mt-3 text-light">Loading Visualization...</div>
                </div><iframe id="viewer-frame" src=""></iframe>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script> // Theme Toggling Logic

            (() => {
                'use strict'

                const getStoredTheme = () => localStorage.getItem('theme')
                const setStoredTheme = theme => localStorage.setItem('theme', theme)
                const getPreferredTheme = () => {
                    const storedTheme = getStoredTheme()
                    if (storedTheme) {
                        return storedTheme
                    }

                    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
                }

                const setTheme = theme => {
                    if (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        document.documentElement.setAttribute('data-bs-theme', 'dark')
                    }

                    else {
                        document.documentElement.setAttribute('data-bs-theme', theme)
                    }
                }

                setTheme(getPreferredTheme())

                const showActiveTheme = (theme, focus = false) => {
                    const themeSwitcher = document.querySelector('.dark-theme-toggle')
                    if (!themeSwitcher) return
                    const btnToActive = document.querySelector(`[data-bs-theme-value="${theme}"]`)
                    document.querySelectorAll('[data-bs-theme-value]').forEach(element => {
                        element.classList.remove('active')
                        element.setAttribute('aria-pressed', 'false')
                    })
                    btnToActive.classList.add('active')
                    btnToActive.setAttribute('aria-pressed', 'true')
                    // Update icon
                    const iconClass = theme === 'dark' ? 'bi-moon-stars-fill' : (theme === 'auto' ? 'bi-circle-half' : 'bi-sun-fill');
                    themeSwitcher.innerHTML = `<i class="${iconClass}"></i><span class="d-lg-none ms-2">Toggle theme</span>`;
                }

                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
                    const storedTheme = getStoredTheme()
                    if (storedTheme !== 'light' && storedTheme !== 'dark') {
                        setTheme(getPreferredTheme())
                    }
                })

                window.addEventListener('DOMContentLoaded', () => {
                    showActiveTheme(getPreferredTheme())

                    document.querySelectorAll('[data-bs-theme-value]').forEach(toggle => {
                        toggle.addEventListener('click', () => {
                            const theme = toggle.getAttribute('data-bs-theme-value')
                            setStoredTheme(theme)
                            setTheme(theme)
                            showActiveTheme(theme, true)
                        })
                    })
                })
            })() // Dashboard Logic

            const cities = {
                bangalore: { url: 'bangalore.html', name: 'Bangalore Analysis' },
                chennai: { url: 'chennai.html', name: 'Chennai Analysis' },
                delhi: { url: 'delhi.html', name: 'Delhi Analysis' },
                paris: { url: 'paris.html', name: 'Paris Analysis' },
                london: { url: 'london.html', name: 'London Analysis' },
                singapore: { url: 'singapore.html', name: 'Singapore Analysis' }
            };

            function loadCity(cityKey, cardElement) {
                if (!cities[cityKey]) return;

                // Update UI active state
                document.querySelectorAll('.city-card').forEach(c => c.classList.remove('active'));
                cardElement.classList.add('active');

                const viewerContainer = document.getElementById('viewer-container');
                const frame = document.getElementById('viewer-frame');
                const loading = document.getElementById('loading-overlay');
                const title = document.getElementById('viewer-title');

                // Show viewer
                viewerContainer.classList.remove('d-none');
                loading.classList.remove('d-none');

                // Update Title
                title.innerHTML = `<i class="bi bi-geo-alt-fill text-primary me-2"></i>${cities[cityKey].name}`;

                // Load content
                frame.src = cities[cityKey].url;

                // Prevent body scroll
                document.body.style.overflow = 'hidden';

                frame.onload = () => {
                    loading.classList.add('d-none');
                };
            }

            function closeViewer() {
                const viewerContainer = document.getElementById('viewer-container');
                const frame = document.getElementById('viewer-frame');

                viewerContainer.classList.add('d-none');
                frame.src = ""; // Clear src to stop resource usage

                // Re-enable body scroll
                document.body.style.overflow = 'auto';

                // Remove active classes
                document.querySelectorAll('.city-card').forEach(c => c.classList.remove('active'));
            }

        </script>
</body>

</html>
